<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calendrier de l‚Äôavent</title>
  <style>
    :root{
      --radius: 16px;
      --gap: 14px;
      --tile-bg: rgba(255,255,255,.18);
      --tile-border: rgba(255,255,255,.28);
      --tile-text: rgba(255,255,255,.92);
      --shadow: 0 10px 18px rgba(0,0,0,.28);
      --shadow-pressed: 0 4px 10px rgba(0,0,0,.18);
      --focus: 0 0 0 3px rgba(255,255,255,.35);
    }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #0f0f10;
      color:#111;
      display:flex;
      justify-content:center;
      padding: 18px;
    }

    .wrap{ width:min(980px, 100%); }

    .frame{
      position:relative;
      width:100%;
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 30px 60px rgba(0,0,0,.35);
      aspect-ratio: 817 / 563;
      background:#111;
      user-select:none;
    }

    .bg{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    /* Toggle en haut √† droite */
    .top-controls{
      position:absolute;
      top: 12px;
      right: 12px;
      display:flex;
      gap: 10px;
      align-items:center;
      z-index: 3;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.32);
      border: 1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(6px);
      box-shadow: 0 10px 20px rgba(0,0,0,.25);
    }

    .top-controls .label{
      color: rgba(255,255,255,.92);
      font-weight: 800;
      font-size: 12px;
      letter-spacing: .2px;
      white-space: nowrap;
      text-shadow: 0 2px 10px rgba(0,0,0,.35);
    }

    /* Switch style ‚Äúradio‚Äù */
    .switch{
      position: relative;
      width: 46px;
      height: 26px;
      border-radius: 999px;
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.22);
      cursor: pointer;
      transition: background .15s ease;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.08);
      flex: 0 0 auto;
    }
    .switch::after{
      content:"";
      position:absolute;
      top: 50%;
      left: 4px;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      transform: translateY(-50%);
      background: rgba(255,255,255,.92);
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
      transition: left .15s ease;
    }
    .switch[data-on="true"]{
      background: rgba(34,197,94,.35); /* vert doux */
      border-color: rgba(34,197,94,.45);
    }
    .switch[data-on="true"]::after{ left: 24px; }

    .switch:focus-visible{
      outline: none;
      box-shadow: 0 0 0 3px rgba(255,255,255,.25);
    }

    /* ZONE DU CALENDRIER (ajustez ces % si besoin) */
    .grid{
      position:absolute;
      left: 6%;
      right: 6%;
      top: 30%;
      bottom: 7%;
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: var(--gap);
      padding: 6px;
      z-index: 2;
    }

    .tile{
      all: unset;
      cursor: pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius: var(--radius);
      background: var(--tile-bg);
      border: 1px solid var(--tile-border);
      backdrop-filter: blur(1.5px);
      color: var(--tile-text);
      font-weight: 800;
      letter-spacing: .3px;
      font-size: clamp(16px, 2.2vw, 26px);
      text-shadow: 0 2px 10px rgba(0,0,0,.35);

      box-shadow: var(--shadow);
      transform: translateY(0);
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease, opacity .12s ease;
    }

    /* Effet ‚Äúenfonc√©‚Äù au survol */
    .tile:hover{
      transform: translateY(4px);
      box-shadow: var(--shadow-pressed);
      background: rgba(255,255,255,.14);
    }

    .tile:active{
      transform: translateY(6px);
      box-shadow: 0 2px 6px rgba(0,0,0,.18);
    }

    .tile:focus-visible{
      box-shadow: var(--shadow), var(--focus);
    }

    .tile[data-locked="true"]{
      opacity: .84;
    }

    /* MODAL */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      place-items:center;
      padding: 18px;
      background: rgba(0,0,0,.55);
      z-index: 999;
    }
    .modal[aria-hidden="false"]{ display:grid; }

    .modal-card{
      width:min(640px, 100%);
      background: rgba(255,255,255,.94);
      border-radius: 22px;
      box-shadow: 0 30px 80px rgba(0,0,0,.4);
      overflow:hidden;
    }
    .modal-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 14px 16px;
      background: rgba(0,0,0,.06);
    }
    .modal-title{
      margin:0;
      font-size: 18px;
      font-weight: 800;
    }
    .modal-close{
      all:unset;
      cursor:pointer;
      width: 40px;
      height: 40px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      font-size: 22px;
      background: rgba(0,0,0,.07);
    }
    .modal-close:hover{ background: rgba(0,0,0,.10); }

    .modal-body{
      padding: 16px;
      display:grid;
      gap: 12px;
    }

    .modal-body img{
      width: min(320px, 100%);
      height: auto;
      display:block;
      margin: 0 auto;
      border-radius: 16px;
      box-shadow: 0 16px 30px rgba(0,0,0,.18);
      background:#fff;
    }

    .msg{
      margin:0;
      line-height:1.45;
      font-size: 15px;
    }

    .link{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.07);
      color:#111;
      text-decoration:none;
      font-weight: 700;
      width: fit-content;
    }
    .link:hover{ background: rgba(0,0,0,.10); }

    @media (max-width: 560px){
      :root{ --gap: 10px; --radius: 14px; }
      .grid{ left: 5%; right: 5%; top: 31%; bottom: 7%; }
      .top-controls{ top: 10px; right: 10px; padding: 7px 9px; }
      .top-controls .label{ font-size: 11px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="frame" id="frame">
      <img class="bg" id="bg" alt="Calendrier de l‚Äôavent" />

      <div class="top-controls" aria-label="Contr√¥le de d√©verrouillage">
        <span class="label" id="toggleLabel">Contr√¥le date : ON</span>
        <button class="switch" id="lockToggle" type="button" data-on="true" aria-pressed="true"
                aria-label="Activer ou d√©sactiver le contr√¥le par date"></button>
      </div>

      <div class="grid" id="grid" aria-label="Calendrier de l‚Äôavent"></div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-head">
        <h2 class="modal-title" id="modalTitle">Case</h2>
        <button class="modal-close" id="modalClose" aria-label="Fermer">√ó</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <script>
    /***********************
     * CONFIG √Ä PERSONNALISER
     ***********************/
    const BACKGROUND_IMAGE = "img_cal.jpg";

    const DEFAULT_TREE_IMAGE_URL =
      "data:image/svg+xml;charset=utf-8," +
      encodeURIComponent(`
        <svg xmlns="http://www.w3.org/2000/svg" width="600" height="600">
          <rect width="100%" height="100%" fill="#ffffff"/>
          <g transform="translate(300,70)">
            <circle cx="0" cy="0" r="10" fill="#f59e0b"/>
            <path d="M0,20 L-120,180 L120,180 Z" fill="#16a34a"/>
            <path d="M0,120 L-150,320 L150,320 Z" fill="#15803d"/>
            <path d="M0,240 L-180,460 L180,460 Z" fill="#166534"/>
            <rect x="-35" y="460" width="70" height="90" rx="8" fill="#92400e"/>
            <circle cx="-60" cy="175" r="10" fill="#ef4444"/>
            <circle cx="70" cy="205" r="10" fill="#3b82f6"/>
            <circle cx="-85" cy="310" r="10" fill="#f97316"/>
            <circle cx="95" cy="345" r="10" fill="#a855f7"/>
            <circle cx="0" cy="265" r="10" fill="#eab308"/>
          </g>
        </svg>
      `);

    // Personnalisation par case : message / image / lien / message "trop t√¥t"
    const DOORS = Array.from({ length: 24 }, (_, i) => {
      const n = i + 1;
      return {
        day: n,
        title: `Case ${n}`,
        message: `Surprise du jour ${n} üéÅ (message personnalisable)`,
        lockedMessage: `C‚Äôest trop t√¥t üôÇ`,
        imageUrl: DEFAULT_TREE_IMAGE_URL,
        linkUrl: "https://example.com"
      };
    });

    /***********************
     * LOGIQUE
     ***********************/
    const grid = document.getElementById("grid");
    const bg = document.getElementById("bg");
    const lockToggle = document.getElementById("lockToggle");
    const toggleLabel = document.getElementById("toggleLabel");

    bg.src = BACKGROUND_IMAGE;

    const modal = document.getElementById("modal");
    const modalTitle = document.getElementById("modalTitle");
    const modalBody = document.getElementById("modalBody");
    const modalClose = document.getElementById("modalClose");

    const now = new Date();
    const today = now.getDate(); // 1..31

    // Contr√¥le date activ√© par d√©faut
    let dateLockEnabled = true;

    function setToggleUI() {
      lockToggle.dataset.on = dateLockEnabled ? "true" : "false";
      lockToggle.setAttribute("aria-pressed", dateLockEnabled ? "true" : "false");
      toggleLabel.textContent = `Contr√¥le date : ${dateLockEnabled ? "ON" : "OFF"}`;
    }

    lockToggle.addEventListener("click", () => {
      dateLockEnabled = !dateLockEnabled;
      setToggleUI();
      render(); // met √† jour l'√©tat visuel "locked"
    });
    setToggleUI();

    function openModal({ title, html }) {
      modalTitle.textContent = title;
      modalBody.innerHTML = html;
      modal.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
      modalClose.focus();
    }

    function closeModal() {
      modal.setAttribute("aria-hidden", "true");
      modalBody.innerHTML = "";
      document.body.style.overflow = "";
    }

    modalClose.addEventListener("click", closeModal);
    modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal.getAttribute("aria-hidden") === "false") closeModal();
    });

    function isLocked(door) {
      if (!dateLockEnabled) return false;
      return door.day > today;
    }

    // M√©lange al√©atoire (Fisher-Yates)
    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function render() {
      grid.innerHTML = "";

      // IMPORTANT : on m√©lange l'ordre √† chaque chargement / rerender
      // Si vous voulez que le m√©lange reste fixe m√™me si on toggle ON/OFF,
      // remplacez par un shuffle fait une seule fois au d√©marrage (voir note en bas).
      const mixed = shuffle(DOORS.slice());

      mixed.forEach((door) => {
        const locked = isLocked(door);

        const btn = document.createElement("button");
        btn.className = "tile";
        btn.type = "button";
        btn.textContent = door.day;
        btn.setAttribute("aria-label", `Ouvrir la case ${door.day}`);
        btn.dataset.day = String(door.day);
        btn.dataset.locked = locked ? "true" : "false";

        btn.addEventListener("click", () => {
          const lockedNow = isLocked(door);

          if (lockedNow) {
            openModal({
              title: `Case ${door.day}`,
              html: `<p class="msg">${escapeHtml(door.lockedMessage || "C‚Äôest trop t√¥t")}</p>`
            });
            return;
          }

          const linkPart = door.linkUrl
            ? `<a class="link" href="${escapeAttr(door.linkUrl)}" target="_blank" rel="noopener">Ouvrir le lien</a>`
            : "";

          const imgPart = door.imageUrl
            ? `<img src="${escapeAttr(door.imageUrl)}" alt="Surprise de la case ${door.day}">`
            : "";

          openModal({
            title: door.title || `Case ${door.day}`,
            html: `
              ${imgPart}
              <p class="msg">${escapeHtml(door.message || "")}</p>
              ${linkPart}
            `
          });
        });

        grid.appendChild(btn);
      });
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function escapeAttr(str) {
      return escapeHtml(str).replaceAll("`","&#096;");
    }

    render();

    /*
      NOTE:
      Actuellement, si vous basculez ON/OFF le contr√¥le date, on re-render => on re-m√©lange.
      Si vous voulez ‚Äúm√©lange au chargement uniquement‚Äù :
        - faites `const mixed = shuffle(DOORS.slice());` une seule fois globalement,
        - puis dans render() utilisez ce tableau sans reshuffle.
    */
  </script>
</body>
</html>
